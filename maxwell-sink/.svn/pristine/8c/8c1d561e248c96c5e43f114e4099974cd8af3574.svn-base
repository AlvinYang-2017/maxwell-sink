package com.cimc.sink.db;

import com.cimc.maxwell.sink.MySqlSinkConfig;
import com.cimc.maxwell.sink.db.MySqlDbWriter;
import org.apache.kafka.connect.sink.SinkRecord;
import org.junit.Test;

import java.io.IOException;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.Properties;

/**
 * Created by 00013708 on 2017/8/16.
 */
public class MySqlDbWriterTest {


    @Test
    public void batchWriteTest() throws IOException, SQLException {
        Properties prop = new Properties();
        prop.load(this.getClass().getClassLoader().getResourceAsStream("maxwell-sink.properties"));
        MySqlSinkConfig config = new MySqlSinkConfig(prop);

        MySqlDbWriter writer = new MySqlDbWriter(config);

        List<SinkRecord> records = new ArrayList<>();

        String topic = "estation.db_ez.t_box";
        int partition = 0;
        long kafkaOffset = 100;
        String key = "{\"database\":\"db_ez\",\"table\":\"t_box\",\"pk.box_id\":\"DC004000292006\"}";
        String val = "{\"database\":\"db_ez\",\"table\":\"t_box\",\"type\":\"update\",\"ts\":1502799315,\"xid\":10217615,\"commit\":true,\"data\":{\"box_id\":\"DC004000292006\",\"sn\":\"518067A348\",\"cabinet\n" +
                "_id\":\"DC004000292\",\"box_type\":\"small\",\"box_type_id\":51,\"box_status\":\"r\",\"box_use_status\":\"book\",\"layout_col\":2,\"layout_row\":2,\"layout_elect\":\"6\",\"update_time\":\"2017-08-15 20:15:16\",\"create_time\":\"2017-01-18 18:40:32\",\"status\":\"y\",\"source\":\"\",\"remark\":\"\"},\"old\":{\"box_use_status\":\"empty\",\"update_time\":\"2017-08-14 14:03:22\"}}";
        SinkRecord record = new SinkRecord(topic,partition,null,key,null,val,kafkaOffset);

        records.add(record);

        writer.batchWrite(records);
    }

}
